"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){var r=this;_classCallCheck(this,e),this.topic=t,this.promise=new Promise(function(e,t){r.resolve=e,r.reject=t})}return _createClass(e,[{key:"link",value:function(e){if(this.externalPromise)throw new Error("Milestone is already linked to a promise");return this.externalPromise=e,this.externalPromise.then(this.resolve)["catch"](this.reject),this}},{key:"reached",value:function(){return this.promise}}]),e}(),r=function(){function e(){_classCallCheck(this,e),this.registry={}}return _createClass(e,[{key:"register",value:function(e,t){return this.getOrCreate(e).link(t)}},{key:"getOrCreate",value:function(e){return this.registry[e]||(this.registry[e]=new t(e)),this.registry[e]}},{key:"when",value:function(){var e=this,t=Array.prototype.slice.call(arguments,0);return Promise.all(t.map(function(t){return e.getOrCreate(t).reached()}))}}]),e}();"undefined"!=typeof window?window.Milestones=r:module.exports=r}();